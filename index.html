<script>
  var map = L.map('map').setView([-34.6037, -58.3816], 13);
  var sidebar = document.getElementById("sidebar");
  var panelAbierto = false;

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  // Marcadores desde JSON
  fetch("puntos.json")
    .then(response => response.json())
    .then(puntos => {
      puntos.forEach(p => {
        var icon = L.icon({
          iconUrl: p.iconUrl,
          iconSize: [30, 40],
          iconAnchor: [15, 40],
          popupAnchor: [0, -35]
        });

        var marker = L.marker([p.lat, p.lng], { icon: icon }).addTo(map);

        marker.on("click", function(e) {
          e.originalEvent.stopPropagation();
          sidebar.style.display = "block";
          sidebar.innerHTML = `<h2>${p.titulo}</h2><p>${p.descripcion}</p>`;
          panelAbierto = true;
        });
      });
    });

  map.on("click", function() {
    if (panelAbierto) {
      sidebar.style.display = "none";
      panelAbierto = false;
    }
  });

  // Buscador con marcador visible
  const provider = new window.GeoSearch.OpenStreetMapProvider();
  const searchControl = new window.GeoSearch.GeoSearchControl({
    provider: provider,
    style: 'bar',
    showMarker: true,
    showPopup: false,
    autoClose: true,
    retainZoomLevel: false,
    position: 'topright', // a la derecha del zoom por defecto
    marker: {
      icon: new L.Icon.Default(),
      draggable: false
    }
  });
  map.addControl(searchControl);
</script>
